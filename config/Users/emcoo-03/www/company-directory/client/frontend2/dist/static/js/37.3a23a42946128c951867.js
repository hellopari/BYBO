webpackJsonp([37],{DpfS:function(t,e){},l8S1:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Xxa5"),r=a.n(s),i=a("exGp"),n=a.n(i),o=a("Dd8w"),l=a.n(o),c=a("NYxO"),v={data:function(){return{card:null,stripe:null,payType:null,isActivity:!1,isLoading:!1,loading:!1,isSuccess:!1,isFree:!1,payment:[],userId:sessionStorage.getItem("userId"),event:{},transfer:{},orderItem:{},member:{}}},methods:l()({},Object(c.b)(["snackbarStateChange"]),{reloadPayType:function(){var t=this;this.loading=!0,this.$http.get("user/payment_managements",{params:{isActive:!0,organizationId:this.$route.params.organizationId}}).then(function(e){t.payment=e.data.content,t.loading=!1})},reloadEvent:function(){var t=this;this.loading=!0,this.$http.get("public/events/"+this.$route.params.id).then(function(e){t.event=e.data,t.loading=!1})},reloadMember:function(){var t=this;this.loading=!0,this.$http.get("members/"+this.$route.params.id).then(function(e){t.member=e.data,t.loading=!1})},onSubmit:function(){null!==this.payType?"ONLINE"===this.payType?(this.isLoading=!0,this.buy()):(this.isLoading=!0,this.offlineBuy()):this.snackbarStateChange({color:"error",text:"請選擇支付類型",snackbar:!0})},buy:function(){var t=this;return n()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.stripe.createToken(t.card).then(function(){var e=n()(r.a.mark(function e(a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==a.token.id){e.next=4;break}return t.isLoading=!1,t.snackbarStateChange({color:"error",text:a.error.message,snackbar:!0}),e.abrupt("return");case 4:if(!t.isActivity){e.next=9;break}t.orderItem.stripeToken=a.token.id,t.onSubmitActivity(),e.next=11;break;case 9:return e.next=11,t.$http.put("members/pay_amount",t.$serialize({memberId:t.$route.params.id,stripeToken:a.token.id})).then(function(e){e.data?(t.isSuccess=!0,t.isLoading=!1):(t.isLoading=!1,t.snackbarStateChange({color:"error",text:"支付失敗",snackbar:!0}))}).catch(function(e){t.isLoading=!1,t.snackbarStateChange({color:"error",text:e.data.message,snackbar:!0})});case 11:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){t.isLoading=!1});case 2:case"end":return e.stop()}},e,t)}))()},back:function(){this.$router.back(),localStorage.removeItem("orderItem")},offlineBuy:function(){this.isActivity?(void 0!==this.orderItem.stripeToken&&delete this.orderItem.stripeToken,this.onSubmitActivity()):this.onSubmitTransaction()},onSubmitTransaction:function(){var t=this;this.$http.put("members/submit_transaction_record",this.$serialize({memberId:this.$route.params.id})).then(function(e){t.snackbarStateChange({color:"success",text:t.$t("message.signup_message"),snackbar:!0}),t.isSuccess=!0,t.isLoading=!1,localStorage.removeItem("orderItem")}).catch(function(e){t.isLoading=!1,t.snackbarStateChange({color:"error",text:e.data.message,snackbar:!0})})},onSubmitActivity:function(){var t=this;this.isLoading=!0,this.isFree||(this.orderItem.payType=this.payType),this.$http.post("event_orders",this.$serialize(this.orderItem)).then(function(e){t.snackbarStateChange({color:"success",text:t.$t("message.signup_message"),snackbar:!0}),t.isSuccess=!0,t.isLoading=!1,localStorage.removeItem("orderItem")}).catch(function(e){t.isLoading=!1,t.snackbarStateChange({color:"error",text:e.data.message,snackbar:!0})})},change:function(t){if("ONLINE"===t.payType){this.stripe=Stripe(t.publishableKey);var e=this.stripe.elements();this.card=e.create("card"),this.card.mount("#card-element")}else this.transfer=t}}),mounted:function(){"activity"===this.$route.params.type?(this.isActivity=!0,this.orderItem=JSON.parse(localStorage.getItem("orderItem")),this.reloadEvent(),0===this.orderItem.order.totalPrice?this.isFree=!0:this.isFree=!1):(this.isActivity=!1,this.isFree=!1,this.reloadMember()),this.reloadPayType()}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"payment-page"},[t.loading?a("div",{staticClass:"text-xs-center mt-5"},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):[t.isSuccess?a("v-container",[a("v-card",{staticClass:"mb-5 center-text mt-5 py-5",attrs:{color:"lighten-1"}},[a("v-icon",{attrs:{size:"100",color:"primary"}},[t._v("check_circle")]),t._v(" "),a("p",{staticClass:"mt-3 title"},[t._v(t._s(t.isActivity?""+t.$t("message.signup_message"):""+t.$t("global.pay_success")))]),t._v(" "),a("v-btn",{attrs:{flat:"",small:"",to:"/"}},[t._v(t._s(t.$t("global.link_home")))]),t._v(" "),t.isActivity?a("v-btn",{attrs:{flat:"",small:"",color:"primary",to:"/users/"+t.userId+"/event"}},[t._v(t._s(t.$t("global.seeSignDes")))]):a("v-btn",{attrs:{flat:"",small:"",color:"primary"},on:{click:function(e){return t.back()}}},[t._v(t._s(t.$t("button.return")))])],1)],1):a("v-container",{staticClass:"mt-5",attrs:{fluid:""}},[a("v-layout",{staticClass:"text-xs-left white px-4 py-3 mb-5",attrs:{column:""}},[a("v-flex",[a("h3",{staticClass:"diamonds headline"},[t._v(t._s(t.$t("global.checkOrder")))])]),t._v(" "),a("v-flex",{staticClass:"mt-5"},[a("div",{staticClass:"subheading primary--text"},[t._v(t._s(t.$t("global.contact")))]),t._v(" "),a("v-card",[t.isActivity?a("v-layout",{staticClass:"mt-3 py-4 px-3 grey lighten-5",attrs:{column:""}},[a("v-flex",[a("span",[t._v(t._s(t.$t("user.user_baseinfo.name"))+"：")]),t._v(" "),a("span",[t._v(t._s(t.orderItem.order.contact))])]),t._v(" "),a("v-flex",{staticClass:"mt-4"},[a("span",[t._v(t._s(t.$t("chamber.select.phone"))+"：")]),t._v(" "),a("span",[t._v(t._s(t.orderItem.order.phone))])]),t._v(" "),a("v-flex",{staticClass:"mt-4"},[a("span",[t._v(t._s(t.$t("user.user_baseinfo.email"))+"：")]),t._v(" "),a("span",[t._v(t._s(t.orderItem.order.email))])])],1):t._e(),t._v(" "),t.isActivity?t._e():a("v-layout",{staticClass:"mt-3 py-4 px-3",attrs:{column:""}},[a("v-flex",[a("span",[t._v(t._s(t.$t("user.user_baseinfo.name"))+"：")]),t._v(" "),"INVITATION"!==t.member.joinType?a("span",[t._v(t._s(t.member.user.userProfile.name))]):a("span",[t._v(t._s(t.member.name))])]),t._v(" "),"INVITATION"!==t.member.joinType?a("v-flex",{staticClass:"mt-4"},[a("span",[t._v(t._s(t.$t("chamber.select.phone"))+"：")]),t._v(" "),a("span",[t._v(t._s(t.member.user.userProfile.phone))])]):t._e(),t._v(" "),a("v-flex",{staticClass:"mt-4"},[a("span",[t._v(t._s(t.$t("user.user_baseinfo.email"))+"：")]),t._v(" "),"INVITATION"!==t.member.joinType?a("span",[t._v(t._s(t.member.user.userProfile.email))]):a("span",[t._v(t._s(t.member.email))])])],1)],1)],1),t._v(" "),t.isActivity?a("v-flex",{staticClass:"mt-5"},[a("div",{staticClass:"subheading indigo--text text-darken-4"},[t._v(t._s(t.$t("global.orderProfile")))]),t._v(" "),a("v-card",[a("v-layout",{staticClass:"px-2 py-2 primary",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{md5:""}},[a("h4",{staticClass:"subheading  white--text  text-darken-4"},[t._v(t._s(t.$t("chamber.activity.name")))])]),t._v(" "),a("v-flex",{staticClass:"hidden-sm-and-down",attrs:{md7:""}},[a("v-layout",{staticClass:"subheading white--text text-darken-4",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("chamber.activity.type")))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("chamber.activity.quantity")))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("chamber.activity.price")))])],1)],1)],1),t._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",[a("v-card",[[a("v-layout",{staticClass:"px-2 py-2 mt-1"},[a("v-flex",{attrs:{md5:""}},[a("v-layout",[a("v-flex",{attrs:{xs12:"",md4:"",lg3:""}},[a("img",{staticStyle:{width:"100%"},attrs:{src:""+t.$fileUrl+t.event.eventFiles[0].key,alt:""}})]),t._v(" "),a("v-flex",{staticClass:"body-2 pl-2",attrs:{xs12:"",md8:"",lg9:""}},[a("div",{staticClass:"subheading"},[t._v(t._s(t.event.title))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-1 text-no-wrap text-truncate"},[t._v(t._s(t.$t("navbar.activity_time"))+"："+t._s(t._f("time")(t.event.startedAt))+" ~ "+t._s(t._f("time")(t.event.endedAt)))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-3 text-no-wrap text-truncate"},[t._v(t._s(t.$t("chamber.activity.address"))+"："+t._s(t.event.address))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-3 text-no-wrap text-truncate hidden-sm-and-up"},[t._v(t._s(t.$t("chamber.activity.type"))+"："+t._s(t.orderItem.orderLineItems[0].title))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-3 text-no-wrap text-truncate hidden-sm-and-up"},[t._v(t._s(t.$t("chamber.activity.quantity"))+"："+t._s(t.orderItem.orderLineItems.length))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-3 text-no-wrap text-truncate hidden-sm-and-up"},[t._v(t._s(t.$t("chamber.activity.price"))+"：$HK "+t._s(t.orderItem.orderLineItems[0].price))])])],1)],1),t._v(" "),a("v-flex",{staticClass:"hidden-sm-and-down",attrs:{md7:""}},[a("v-layout",{staticClass:"grey--text text--darken-1",attrs:{row:"",wrap:"","align-center":"","justify-center":"",row:"","fill-height":""}},[a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.orderItem.orderLineItems[0].title))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[a("div",{staticClass:"pl-2"},[t._v(t._s(t.orderItem.orderLineItems.length))])]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[a("div",{staticClass:"pl-1 error--text"},[t._v("$HK "+t._s(t.orderItem.orderLineItems[0].price))])])],1)],1)],1)]],2)],1)],1)],1)],1):a("v-flex",{staticClass:"mt-5"},[a("div",{staticClass:"subheading indigo--text text-darken-4"},[t._v(t._s(t.$t("global.orderProfile")))]),t._v(" "),a("div",[a("v-layout",{staticClass:"px-2 py-2 primary ",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{md5:"",xs12:""}},[a("h4",{staticClass:"subheading  white--text  text-darken-4"},[t._v(t._s(t.$t("chamber.create.name")))])]),t._v(" "),a("v-flex",{staticClass:"hidden-sm-and-down",attrs:{md7:"",xs12:""}},[a("v-layout",{staticClass:"subheading white--text text-darken-4",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("global.apply_group")))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("global.apply_position")))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.$t("global.paid")))])],1)],1)],1),t._v(" "),a("v-layout",{attrs:{column:""}},[a("v-flex",[[a("v-card",[a("v-layout",{staticClass:"px-2 py-2  mt-1"},[a("v-flex",{attrs:{md5:"",xs12:""}},[a("v-layout",[a("v-flex",{attrs:{xs4:"",md4:"",lg3:""}},[a("img",{staticStyle:{width:"100%"},attrs:{src:""+t.$fileUrl+t.member.organization.logo,alt:""}})]),t._v(" "),a("v-flex",{staticClass:"body-2 pl-2",attrs:{xs12:"",md8:"",lg9:""}},[a("div",{staticClass:"subheading"},[t._v(t._s(t.member.organization.name))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-1"},[t._v(t._s(t.$t("cocShow.navbar.founding_time"))+"："+t._s(t.member.organization.establishedDate)+" ")]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-3"},[t._v(t._s(t.$t("chamber.create.address"))+"："+t._s(t.member.organization.address))])])],1),t._v(" "),a("v-layout",{staticClass:"hidden-sm-and-up"},[a("v-flex",{staticClass:"body-2 pl-2",attrs:{xs12:""}},[a("div",{staticClass:"subheading"},[t._v(t._s(t.$t("global.apply_group"))+": "+t._s(t.member.membership.name))]),t._v(" "),a("div",{staticClass:"grey--text text--darken-1 mt-1"},[t._v(t._s(t.$t("global.apply_position"))+"："+t._s(t.member.memberPosition.title)+" ")]),t._v(" "),a("div",{staticClass:"error--text text--darken-1 mt-3"},[t._v(t._s(t.$t("global.paid"))+"：$HK "+t._s(t.member.membership.amount))])])],1)],1),t._v(" "),a("v-flex",{staticClass:"hidden-sm-and-down",attrs:{md7:"",xs12:""}},[a("v-layout",{staticClass:"grey--text text--darken-1",attrs:{row:"",wrap:"","align-center":"","justify-center":"",row:"","fill-height":""}},[a("v-flex",{attrs:{xs4:""}},[t._v(t._s(t.member.membership.name))]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[a("div",{staticClass:"pl-2"},[t._v(t._s(t.member.memberPosition.title))])]),t._v(" "),a("v-flex",{attrs:{xs4:""}},[a("div",{staticClass:"pl-1 error--text"},[t._v("$HK "+t._s(t.member.membership.amount))])])],1)],1)],1)],1)]],2)],1)],1)]),t._v(" "),t.isActivity?a("v-flex",{staticClass:"red--text mt-3"},[t._v(t._s(t.$t("global.order_text")))]):t._e(),t._v(" "),t.payment.length>0?a("v-flex",{staticClass:"mt-5"},[t.isFree?t._e():[a("div",[a("span",{staticClass:"subheading indigo--text text-darken-4"},[t._v(t._s(t.$t("global.paymentMethod")))]),t._v(" "),a("v-radio-group",{attrs:{row:""},model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[t._l(t.payment,function(e){return["ONLINE"===e.payType?a("v-radio",{attrs:{color:"primary",label:t.$t("global.online"),value:e.payType},on:{change:function(a){return t.change(e)}}}):a("v-radio",{attrs:{color:"primary",label:t.$t("global.transfer"),value:e.payType},on:{change:function(a){return t.change(e)}}})]})],2)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"ONLINE"===t.payType,expression:"payType === 'ONLINE'"}],staticClass:"mt-4"},[a("form",{attrs:{action:"/charge",method:"post",id:"payment-form"}},[a("div",{staticClass:"form-row"},[a("div",{attrs:{id:"card-element"}}),t._v(" "),a("div",{attrs:{id:"card-errors",role:"alert"}})])])]),t._v(" "),"TRANSFER"===t.payType?a("div",{staticClass:"mt-4"},[a("p",[t._v(t._s(t.$t("chamber.payment.number"))+": "+t._s(t.transfer.cardNumber))]),t._v(" "),a("p",[t._v(t._s(t.$t("chamber.payment.name"))+": "+t._s(t.transfer.bankName))])]):t._e()],t._v(" "),t.isFree?a("v-layout",{staticClass:"my-5 text-xs-center"},[a("v-flex",{staticClass:"text-xs-center"},[a("v-btn",{attrs:{color:"primary",loading:t.isLoading,disabled:t.isLoading},on:{click:function(e){return t.onSubmitActivity()}}},[t._v(t._s(t.$t("cocShow.activity.me_apply")))]),t._v(" "),a("v-btn",{on:{click:function(e){return t.back()}}},[t._v(t._s(t.$t("button.cancel")))])],1)],1):a("v-layout",{staticClass:"my-5 text-xs-center"},[a("v-flex",{staticClass:"text-xs-center"},[a("v-btn",{on:{click:function(e){return t.back()}}},[t._v(t._s(t.$t("button.cancel")))]),t._v(" "),a("v-btn",{attrs:{color:"primary",loading:t.isLoading,disabled:t.isLoading},on:{click:function(e){return t.onSubmit()}}},[t._v(t._s(t.$t("global.payment")))])],1)],1)],2):a("v-flex",{staticClass:"mt-5"},[a("v-icon",{attrs:{size:"100"}},[t._v("payment")]),t._v(" "),a("p",[t._v(" "+t._s(t.$t("global.noPay"))+"\n          ")])],1)],1)],1)]],2)},staticRenderFns:[]};var d=a("VU/8")(v,m,!1,function(t){a("DpfS")},"data-v-0217bebd",null);e.default=d.exports}});
webpackJsonp([33],{TrcO:function(e,t){},wpIB:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Dd8w"),i=s.n(a),n=s("NYxO"),r={data:function(){return{pagination:{sortBy:"createdAt"},items:[{id:" ",abbr:this.$t("cocShow.home.whole")},{id:"1",abbr:this.$t("global.chargeTicket"),statusType:"expenses"},{id:"0",abbr:this.$t("global.freeTicket"),statusType:"eventTicketPrice"}],select:{id:" ",abbr:this.$t("cocShow.home.whole")},items1:[{id:" ",abbr:this.$t("cocShow.home.whole")},{id:"SUCCESS",abbr:this.$t("global.SUCCESS"),statusType:"statusType"},{id:"PENDING",abbr:this.$t("global.PENDING"),statusType:"statusType"},{id:"REFUSE",abbr:this.$t("global.REFUSE"),statusType:"statusType"}],select1:{id:" ",abbr:this.$t("cocShow.home.whole")},selectPosition:{},all:!1,isLoading:!1,loading:!1,limit:[10],totalDesserts:0,totalPages:0,selected:[],checkTicket:{referenceNumber:null},filters:{search:null,memberGroups:null,"organization.id":this.$route.params.organizationId,"event.id":this.$route.params.signId,page:0,size:9},headers:[{text:"chamber.member.phone",value:"phone",sortable:!1},{text:"chamber.member.email",value:"email",sortable:!1},{text:"chamber.member.status",value:"status",sortable:!1},{text:"global.ticket",value:"ticket",sortable:!1},{text:"global.code",value:"ticket"},{text:"global.ticketState",value:"group",sortable:!1},{text:"global.signTime",value:"createdAt",sortable:!1},{text:"chamber.member.operation",value:"operation",sortable:!1}],desserts:[],rules:{required:function(e){return!!e||"This field is required"},email:function(e){return(e||"").match(/@/)||"Please enter a valid email"}}}},watch:{pagination:{handler:function(){var e=this;if(this.filters.page!==this.pagination.page-1)this.filters.page=this.pagination.page-1,this.reloadTable();else{var t=this.pagination.sortBy;this.desserts=this.desserts.sort(function(s,a){var i=s[t],n=a[t];return e.pagination.descending?i<n?1:i>n?-1:0:i<n?-1:i>n?1:0})}},deep:!0}},mounted:function(){this.filters.page=void 0!==this.$route.query.page?Number(this.$route.query.page)-1:0,this.reloadTable()},methods:i()({},Object(n.b)(["snackbarStateChange"]),{toggleAll:function(){this.selected.length?this.selected=[]:this.selected=this.desserts.slice()},changeSort:function(e){this.pagination.sortBy===e?this.pagination.descending=!this.pagination.descending:(this.pagination.sortBy=e,this.pagination.descending=!1)},reloadTable:function(){var e=this;this.loading=!0,null===this.filters.search&&delete this.filters.search,this.$http.get("manager/event_attendees",{params:this.filters,headers:{"X-TENANT-ID":this.$route.params.organizationId}}).then(function(t){e.desserts=t.data.content,e.totalDesserts=t.data.totalElements,e.totalPages=t.data.totalPages,e.loading=!1})},checkTickets:function(){var e=this;null!==this.checkTicket.referenceNumber?this.$http.post("manager/event_attendees/inspectTicket",this.$serialize(this.checkTicket),{headers:{"X-TENANT-ID":this.$route.params.organizationId}}).then(function(t){e.snackbarStateChange({color:"success",text:e.$t("message.update_message"),snackbar:!0}),e.reloadTable()}).catch(function(t){e.snackbarStateChange({color:"error",text:t.data.message,snackbar:!0}),e.isLoading=!1}):this.snackbarStateChange({color:"error",text:this.$t("message.re_code"),snackbar:!0})},checkup:function(e){var t=this;if(this.selected.length>0){this.isLoading=!0;var s=new URLSearchParams;-1!==this.selected.findIndex(function(e){return"PENDING"===e.statusType})?(this.selected.forEach(function(e,t){"PENDING"===e.statusType&&s.append("eventAttendeeIds["+t+"]",e.id)}),s.append("organization.id",this.$route.params.organizationId),s.append("status",e),this.$http.post("manager/event_attendees/checkup",s,{headers:{"X-TENANT-ID":this.$route.params.organizationId}}).then(function(e){t.snackbarStateChange({color:"success",text:t.$t("message.update_message"),snackbar:!0}),t.isLoading=!1,t.reloadTable(),t.selected=[]}).catch(function(e){t.snackbarStateChange({color:"pink",text:e.data.message,snackbar:!0}),t.isLoading=!1})):(this.isLoading=!1,this.snackbarStateChange({color:"pink",text:"不能重複審核活動",snackbar:!0}))}else this.snackbarStateChange({color:"pink",text:this.$t("message.editAttendeess"),snackbar:!0})},exportSign:function(){location.href="https://api.connected.hk/api/v1/event_attendees/poi?eventId="+this.$route.params.signId,this.snackbarStateChange({color:"primary",text:this.$t("message.export_message"),snackbar:!0})},deleteAttendeess:function(){var e=this;if(this.selected.length>0){this.isLoading=!0;var t=this.selected.map(function(e){return e.id});this.$http.delete("event_attendees/"+t.join(","),{headers:{"X-TENANT-ID":this.$route.params.organizationId}}).then(function(t){e.snackbarStateChange({color:"success",text:e.$t("message.delete_success"),snackbar:!0}),e.isLoading=!1,e.selected=[],e.reloadTable()}).catch(function(t){e.snackbarStateChange({color:"pink",text:t.data.message,snackbar:!0}),e.isLoading=!1})}else this.snackbarStateChange({color:"pink",text:this.$t("message.editAttendeess"),snackbar:!0})},change:function(e){void 0===e.statusType?(delete this.filters.expenses,delete this.filters.eventTicketPrice,delete this.filters.statusType,this.reloadTable()):("expenses"===e.statusType&&delete this.filters.eventTicketPrice,"eventTicketPrice"===e.statusType&&delete this.filters.expenses,this.filters[e.statusType]=e.id,this.reloadTable())},handleInput:function(e){this.pagination.page=e,this.$router.push({path:"/organization/"+this.$route.params.organizationId+"/sign/"+this.$route.params.signId+"/list",query:{page:e}}),this.filters.page=e-1,this.reloadTable()}})},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"sign"}},[s("v-layout",{staticClass:"mx-4 mt-4",attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"mr-3",attrs:{md1:""}},[s("v-select",{attrs:{items:e.items,"item-text":"abbr","item-value":"id",label:"Select","persistent-hint":"","return-object":"","single-line":""},on:{change:function(t){return e.change(e.select)}},model:{value:e.select,callback:function(t){e.select=t},expression:"select"}})],1),e._v(" "),s("v-flex",{staticClass:"mr-3",attrs:{md1:""}},[s("v-select",{attrs:{items:e.items1,"item-text":"abbr","item-value":"id",label:"Select","persistent-hint":"","return-object":"","single-line":""},on:{change:function(t){return e.change(e.select1)}},model:{value:e.select1,callback:function(t){e.select1=t},expression:"select1"}})],1),e._v(" "),s("v-flex",{attrs:{md3:"",sm4:""}},[s("v-text-field",{staticClass:"px3",attrs:{label:e.$t("global.search_text"),"prepend-icon":"search",px3:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reloadTable()}},model:{value:e.filters.search,callback:function(t){e.$set(e.filters,"search",t)},expression:"filters.search"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:"",md3:""}},[s("v-text-field",{staticClass:"px3",attrs:{label:e.$t("global.hasArrivedCode"),"prepend-icon":"search",px3:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.checkTickets()}},model:{value:e.checkTicket.referenceNumber,callback:function(t){e.$set(e.checkTicket,"referenceNumber",t)},expression:"checkTicket.referenceNumber"}})],1)],1),e._v(" "),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"mx-3",attrs:{xs12:""}},[s("v-btn",{attrs:{color:"success",loading:e.isLoading},on:{click:function(t){return e.checkup("SUCCESS")}}},[e._v(e._s(e.$t("chamber.btn.adopt")))]),e._v(" "),s("v-btn",{attrs:{color:"error",loading:e.isLoading},on:{click:function(t){return e.checkup("REFUSE")}}},[e._v(e._s(e.$t("chamber.btn.refuse")))]),e._v(" "),s("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.exportSign()}}},[e._v(e._s(e.$t("chamber.btn.export")))])],1)],1),e._v(" "),s("v-data-table",{staticClass:"rtable rtable--flip elevation-1",attrs:{"hide-actions":"",headers:e.headers,"no-data-text":e.$t("message.no_message"),items:e.desserts,loading:e.loading,pagination:e.pagination,"rows-per-page-items":e.limit,"total-items":e.totalDesserts,"select-all":""},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"headers",fn:function(t){return[s("tr",[s("th",[s("v-checkbox",{attrs:{color:"primary","input-value":t.all,label:e.$t("chamber.member.name"),indeterminate:t.indeterminate,primary:"","hide-details":""},nativeOn:{click:function(t){return e.toggleAll(t)}}})],1),e._v(" "),e._l(t.headers,function(t){return s("th",{key:t.text,staticClass:"text-xs-left",class:["column sortable",e.pagination.descending?"desc":"asc",t.value===e.pagination.sortBy?"active":""],on:{click:function(s){return e.changeSort(t.value)}}},[e._v("\n          "+e._s(e.$t(t.text))+"\n          "),s("v-icon",{attrs:{small:""}},[e._v("arrow_upward")])],1)})],2)]}},{key:"items",fn:function(t){return[s("tr",{attrs:{active:t.selected}},[s("td",{staticStyle:{position:"relative"}},[s("v-checkbox",{attrs:{color:"primary","input-value":t.selected,disabled:"PENDING"!==t.item.statusType,label:t.item.order.contact,primary:"","hide-details":""},on:{click:function(e){t.selected=!t.selected}}})],1),e._v(" "),s("td",{staticClass:"text-xs-left"},[e._v("\n          "+e._s(t.item.order.phone)+"\n        ")]),e._v(" "),s("td",{staticClass:"text-xs-left"},[e._v(e._s(t.item.order.email))]),e._v(" "),s("td",{staticClass:"text-xs-left"},["PENDING"===t.item.statusType?s("span",{staticClass:"warning--text"},[e._v(e._s(e.$t("chamber.btn.audited")))]):e._e(),e._v(" "),"SUCCESS"===t.item.statusType?s("span",{staticClass:"success--text"},[e._v(e._s(e.$t("global.SUCCESS")))]):e._e(),e._v(" "),"REFUSE"===t.item.statusType?s("span",{staticClass:"error--text"},[e._v(e._s(e.$t("chamber.btn.refuse")))]):e._e()]),e._v(" "),s("td",{staticClass:"text-xs-left"},[0===t.item.eventTicket.price?s("span",{staticClass:"pt-4"},[e._v(" "+e._s(e.$t("global.freeTicket")))]):s("span",{staticClass:"pt-4"},[e._v(" "+e._s(e.$t("global.chargeTicket")))]),e._v(" "),s("p",{staticClass:"error--text"},[e._v("$HK "+e._s(t.item.eventTicket.price))])]),e._v(" "),s("td",{staticClass:"text-xs-left"},[e._v("\n          "+e._s(t.item.referenceNumber)+"\n        ")]),e._v(" "),s("td",{staticClass:"text-xs-left"},[t.item.hasArrived?s("span",{staticClass:"success--text"},[e._v(" "+e._s(e.$t("global.hasArrived")))]):s("span",{staticClass:"error--text"},[e._v(" "+e._s(e.$t("global.nhasArrived")))])]),e._v(" "),s("td",{staticClass:"text-xs-left"},[e._v("\n          "+e._s(e._f("time")(t.item.order.createdAt))+"\n        ")]),e._v(" "),s("td",{staticClass:"text-md-center text-xs-left"},[s("v-tooltip",{attrs:{top:""}},[s("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"error"},on:{click:function(t){return e.deleteAttendeess()}},slot:"activator"},[s("v-icon",{attrs:{size:"18"}},[e._v("close")])],1),e._v(" "),s("span",[e._v(e._s(e.$t("button.delete")))])],1)],1)])]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[e._v(" "),e._v(" "),s("template",{slot:"footer"},[s("td",{staticClass:"px-0",attrs:{colspan:e.headers.length+1}},[s("v-pagination",{staticClass:"pull-right my-2",attrs:{circle:"","total-visible":7,length:e.totalPages},on:{input:e.handleInput},model:{value:e.filters.page+1,callback:function(t){e.$set(e.filters,"page+1",t)},expression:"filters.page+1"}})],1)])],2)],1)},staticRenderFns:[]};var c=s("VU/8")(r,l,!1,function(e){s("TrcO")},null,null);t.default=c.exports}});